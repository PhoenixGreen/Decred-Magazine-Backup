{"version":3,"file":"clean-basic-html.js","sources":["../lib/clean-basic-html.js"],"sourcesContent":["/* global DOMParser, window */\nexport default function cleanBasicHtml(html = '', _options = {}) {\n    const defaults = {};\n    const options = Object.assign({}, defaults, _options);\n\n    if (!options.createDocument) {\n        const Parser = (typeof DOMParser !== 'undefined' && DOMParser) || (typeof window !== 'undefined' && window.DOMParser);\n\n        if (!Parser) {\n            throw new Error('cleanBasicHtml() must be passed a `createDocument` function as an option when used in a non-browser environment');\n        }\n\n        options.createDocument = function (docHtml) {\n            const parser = new Parser();\n            return parser.parseFromString(docHtml, 'text/html');\n        };\n    }\n\n    let cleanHtml = html;\n\n    if (!options.allowBr || cleanHtml === '<br>') {\n        cleanHtml = cleanHtml\n            .replace(/<br\\s?\\/?>/g, ' ');\n    }\n\n    cleanHtml = cleanHtml\n        .replace(/(\\s|&nbsp;){2,}/g, ' ')\n        .trim()\n        .replace(/^&nbsp;|&nbsp$/g, '')\n        .trim();\n\n    // remove any elements that have a blank textContent\n    if (cleanHtml) {\n        let doc = options.createDocument(cleanHtml);\n\n        doc.body.querySelectorAll('*').forEach((element) => {\n            // Treat Zero Width Non-Joiner characters as spaces\n            if (!element.textContent.trim().replace(/\\u200c+/g, '')) {\n                if (options.allowBr && element.tagName === 'BR') {\n                    // keep it\n                    return;\n                }\n                if (options.allowBr && element.querySelector('br')) {\n                    return element.replaceWith(doc.createElement('br'));\n                }\n                if (element.textContent.length > 0) {\n                    // keep a single space to avoid collapsing spaces\n                    let space = doc.createTextNode(' ');\n                    return element.replaceWith(space);\n                }\n                return element.remove();\n            }\n        });\n\n        cleanHtml = doc.body.innerHTML.trim();\n    }\n\n    return cleanHtml;\n}\n"],"names":["cleanBasicHtml","html","_options","defaults","options","Object","assign","createDocument","Parser","DOMParser","window","Error","docHtml","parser","parseFromString","cleanHtml","allowBr","replace","trim","doc","body","querySelectorAll","forEach","element","textContent","tagName","querySelector","replaceWith","createElement","length","space","createTextNode","remove","innerHTML"],"mappings":"AAAA;AACe,SAASA,cAAT,GAAkD;AAAA,EAA1BC,IAAAA,IAA0B,uEAAnB,EAAmB,CAAA;;AAAA,EAAfC,IAAAA,QAAe,uEAAJ,EAAI,CAAA;;AAC7D,EAAMC,MAAAA,QAAQ,GAAG,EAAjB,CAAA;AACA,EAAMC,MAAAA,OAAO,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBH,QAAlB,EAA4BD,QAA5B,CAAhB,CAAA;;AAEA,EAAA,IAAI,CAACE,OAAO,CAACG,cAAb,EAA6B;AACzB,IAAA,MAAMC,MAAM,GAAI,OAAOC,SAAP,KAAqB,WAArB,IAAoCA,SAArC,IAAoD,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,MAAM,CAACD,SAA3G,CAAA;;AAEA,IAAI,IAAA,CAACD,MAAL,EAAa;AACT,MAAA,MAAM,IAAIG,KAAJ,CAAU,iHAAV,CAAN,CAAA;AACH,KAAA;;AAEDP,IAAAA,OAAO,CAACG,cAAR,GAAyB,UAAUK,OAAV,EAAmB;AACxC,MAAA,MAAMC,MAAM,GAAG,IAAIL,MAAJ,EAAf,CAAA;AACA,MAAA,OAAOK,MAAM,CAACC,eAAP,CAAuBF,OAAvB,EAAgC,WAAhC,CAAP,CAAA;AACH,KAHD,CAAA;AAIH,GAAA;;AAED,EAAIG,IAAAA,SAAS,GAAGd,IAAhB,CAAA;;AAEA,EAAI,IAAA,CAACG,OAAO,CAACY,OAAT,IAAoBD,SAAS,KAAK,MAAtC,EAA8C;AAC1CA,IAAAA,SAAS,GAAGA,SAAS,CAChBE,OADO,CACC,aADD,EACgB,GADhB,CAAZ,CAAA;AAEH,GAAA;;AAEDF,EAAAA,SAAS,GAAGA,SAAS,CAChBE,OADO,CACC,kBADD,EACqB,GADrB,CAAA,CAEPC,IAFO,EAGPD,CAAAA,OAHO,CAGC,iBAHD,EAGoB,EAHpB,CAIPC,CAAAA,IAJO,EAAZ,CAxB6D;;AA+B7D,EAAA,IAAIH,SAAJ,EAAe;AACX,IAAA,IAAII,GAAG,GAAGf,OAAO,CAACG,cAAR,CAAuBQ,SAAvB,CAAV,CAAA;AAEAI,IAAAA,GAAG,CAACC,IAAJ,CAASC,gBAAT,CAA0B,GAA1B,CAA+BC,CAAAA,OAA/B,CAAwCC,OAAD,IAAa;AAChD;AACA,MAAA,IAAI,CAACA,OAAO,CAACC,WAAR,CAAoBN,IAApB,EAA2BD,CAAAA,OAA3B,CAAmC,UAAnC,EAA+C,EAA/C,CAAL,EAAyD;AACrD,QAAIb,IAAAA,OAAO,CAACY,OAAR,IAAmBO,OAAO,CAACE,OAAR,KAAoB,IAA3C,EAAiD;AAC7C;AACA,UAAA,OAAA;AACH,SAAA;;AACD,QAAIrB,IAAAA,OAAO,CAACY,OAAR,IAAmBO,OAAO,CAACG,aAAR,CAAsB,IAAtB,CAAvB,EAAoD;AAChD,UAAOH,OAAAA,OAAO,CAACI,WAAR,CAAoBR,GAAG,CAACS,aAAJ,CAAkB,IAAlB,CAApB,CAAP,CAAA;AACH,SAAA;;AACD,QAAA,IAAIL,OAAO,CAACC,WAAR,CAAoBK,MAApB,GAA6B,CAAjC,EAAoC;AAChC;AACA,UAAA,IAAIC,KAAK,GAAGX,GAAG,CAACY,cAAJ,CAAmB,GAAnB,CAAZ,CAAA;AACA,UAAA,OAAOR,OAAO,CAACI,WAAR,CAAoBG,KAApB,CAAP,CAAA;AACH,SAAA;;AACD,QAAOP,OAAAA,OAAO,CAACS,MAAR,EAAP,CAAA;AACH,OAAA;AACJ,KAjBD,CAAA,CAAA;AAmBAjB,IAAAA,SAAS,GAAGI,GAAG,CAACC,IAAJ,CAASa,SAAT,CAAmBf,IAAnB,EAAZ,CAAA;AACH,GAAA;;AAED,EAAA,OAAOH,SAAP,CAAA;AACH;;;;"}